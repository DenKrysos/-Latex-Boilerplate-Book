\input{"./2ProjectSetup".tex}%
\input{"\DenKrLayoutMainRootDir/2includes/packages/preamble_pre".tex}%
\documentclass[tikz,fontsize=11pt,class=scrbook]{standalone}% I.e. the content from \input{"\DenKrLayoutMainRootDir/2layout/tikz_standalone/preamble_1_class".tex}%
\input{"\DenKrLayoutBaseRootDir/tikz_standalone/1TikzStandalonePicIncludeThis".tex}%
\DenKrTikzStandalonePre%
%
%
\let\nodedistance\undefined%
\newlength\nodedistance%
\setlength\nodedistance{1.0cm}%
% \newcommand\nodedistance{1.0cm}%
\newcommand\innabst{0.8em}% Abstand zwischen Text und Zellenrand
\let\procwidth\undefined%
\newlength\procwidth%
\settowidth{\procwidth}{\textbf{Forwarding Path}}%
\setlength\procwidth{\procwidth+\innabst+\innabst+1em}%
\setlength\procwidth{6em}%
\let\breiteZwei\undefined%
\newlength\breiteZwei%
% \settowidth{\breiteZwei}{\textbf{OVS Manager}}%
% \setlength\breiteZwei{\breiteZwei+\innabst+\innabst+1em}%
\setlength\breiteZwei{10cm}%
\let\procheight\undefined%
\newlength\procheight%
\setlength\procheight{2\baselineskip}%
\renewcommand\roundcorneramount{2mm}%
%
% Define the layers to draw the diagram
\pgfdeclarelayer{background}%
% \pgfdeclarelayer{foreground}
\pgfsetlayers{background,main}%,foreground}
%
\tikzset{%
    o/.style={%
        shorten >=0,%
        decoration={%
            markings,%
            mark={%
                at position 1%
                with {%
                    \fill circle [radius=#1];%
                }%
            }%
        },%
        postaction=decorate%
    },%
    o/.default=0.5*\pgflinewidth%
}%
\makeatletter
\tikzset{
  use path/.code={\pgfsyssoftpath@setcurrentpath{#1}}
}
\makeatother
%
\begin{tikzpicture}[
	scale = 1.0,%Könnte das Makro \tikzpicturescale sein. Siehe in makros.tex
	% (Sollte eigentlich übergeben werden)(Beachte Möglichkeiten der Übergabe;
	% standalone mode=tex vs mode=buildnew)
	auto,
	node distance=\nodedistance
]
%
\tikzstyle{proc}=[
	rectangle,
	rounded corners=\roundcorneramount,
	minimum width=\procwidth,
	minimum height=\procheight,
	text centered,
	align=center,
	inner sep=0pt,%\innabst,
	draw=black
	%fill=gray!30
]%
\tikzstyle{input}=[
	%inner sep=0pt,%\innabst,
	inner xsep=0.4ex,
    anchor=south east,
    %font=\small,
    scale=0.85,
	text centered,
	align=center
]%
\tikzstyle{output}=[
    input,
    anchor=south west
]%
\tikzstyle{threadinvisible}=[
	rectangle,
	rounded corners=\roundcorneramount,
	minimum width=3cm,
	minimum height=1cm,
	text centered,
	align=center,
% 	draw=black,
% 	fill=red!30
]%
\tikzstyle{arrow} = [thick,->,>=stealth]%
\tikzstyle{arrowdouble} = [ultra thick,<->,>=latex]%
\tikzstyle{arrowwait} = [ultra thick,->,>=stealth,
	dash pattern=on \pgflinewidth off 6pt]%
\tikzstyle{arrowkomm} = [ultra thick,<->,>=latex,
	dash pattern=on 8pt off 6pt on 2pt off 6pt]%
\tikzstyle{connect} = [ultra thick,-,o]%
%
%
\begin{pgfonlayer}{main}%
%
%
	\node(p_a)%
		[proc,anchor=north west]%
		{$P_a(I_a, S_a)$};%
	\node(p_c)%
		[proc,right=\nodedistance of p_a]%
		{$P_c(I_c, S_c)$};%
	\node(p_b)%
		[proc,above=0.5\nodedistance of p_c]%
		{$P_b(I_b, S_b)$};%
	\node(p_d)%
		[proc,below=0.5\nodedistance of p_c]%
		{$P_d(I_d, S_d)$};%
%
	\node(p_e)%
		[proc,right=\nodedistance of $(p_b.south east) !.5! (p_c.north east)$]%
		{$P_e(I_e, S_e)$};%
	\node(p_f)%
		[proc,right=\nodedistance of p_d]%
		{$P_f(I_f, S_f)$};%
%
	\node(p_g)%
		[proc,anchor=west]%
		at($(p_a.east-|p_e.east)+(1*\nodedistance,0)$)%
		{$P_g(I_g, S_g)$};%
%
%
%
%
%
    \coordinate(lower_topleft)at($(p_a.north west|-p_b.north)+(0,1em)$);%
    \coordinate(lower_topright)at(p_g.north east|-lower_topleft);%
    \path let\n1={3em}in
        coordinate(upper_bottomleft)at($(lower_topleft)+(0,\n1)$)%
        coordinate(upper_bottomright)at($(lower_topright)+(0,\n1)$)%
        ;%
    \coordinate(lower_topleft_shift)at($(lower_topleft)+(-0.25\nodedistance,0)$);%
    \coordinate(lower_topright_shift)at($(lower_topright)+(0.25\nodedistance,0)$);%
    \coordinate(upper_bottomleft_shift)at($(upper_bottomleft)+(-0.25\nodedistance,0)$);%
    \coordinate(upper_bottomright_shift)at($(upper_bottomright)+(0.25\nodedistance,0)$);%
    \draw[dashed]($(lower_topleft_shift) !.2! (upper_bottomleft_shift)$)--($(lower_topright_shift) !.2! (upper_bottomright_shift)$);%
    \draw[dashed]($(lower_topleft_shift) !.8! (upper_bottomleft_shift)$)--($(lower_topright_shift) !.8! (upper_bottomright_shift)$);%
    \node(description)%
        [anchor=center, inner sep=0pt]%
        at($(lower_topleft) !.5! (upper_bottomright)$)%
        {\normalfont\small $P()$ decomposes with $I=I_a$ \& $O=O_g$ to:};%
%
%
%
%
    \let\Pheight\undefined%
    \newlength\Pheight%
    \setlength\Pheight{2em}%
    \coordinate(P_bottomleft)at($(upper_bottomleft)+(0,0.5em)$);
    \coordinate(P_bottomright)at(upper_bottomright |- P_bottomleft);
    \coordinate(P_topleft)at($(P_bottomleft)+(0,\Pheight)$);
    \coordinate(P_topright)at($(P_bottomright)+(0,\Pheight)$);
    \coordinate(P_north)at($(P_topleft)!.5!(P_topright)$);
    \coordinate(P_south)at($(P_bottomleft)!.5!(P_bottomright)$);
    \coordinate(P_west)at($(P_topleft)!.5!(P_bottomleft)$);
    \coordinate(P_east)at($(P_topright)!.5!(P_bottomright)$);
    \tikzstyle{cornRounding}=[rounded corners=0.5em]%
    \path[draw]($(P_north)+(0.1pt,0)$){[cornRounding]-|(P_east)}{[cornRounding]|-(P_south)}{[cornRounding]-|(P_west)}{[cornRounding]|-($(P_north)+(-0.1pt,0)$)}--($(P_north)+(0.1pt,0)$)--cycle;%
    \node(P_label)%
        [inner sep=0pt, anchor=center]%
        at($(P_topleft)!.5!(P_bottomright)$)%
        {$P(I, S)$};
%
%
%
%
%
%
    \path[arrow,<-,draw](P_west)%
            node[input]{$I$}%
        --++(-0.5\nodedistance,0);%
    \path[arrow,draw](P_east)%
            node[output]{$O$}%
        --++(0.5\nodedistance,0);%
%
    \path[arrow,<-,draw](p_a.west)%
            node[input]{$I_a$}%
        --++(-0.5\nodedistance,0);%
    \path[arrow,draw](p_g.east)%
            node[output]{$O_g$}%
        --++(0.5\nodedistance,0);%
%
%
%
%
%
%
    \path[arrow,draw]($(p_a.north east) !.5! (p_a.east)$)%
        --++%
        (0.5*\nodedistance,0)%
            coordinate(oaConnect)%
        |-(p_b.west)%
            node[input]{$I_b$};%
    \path let\p1=(p_a.north east),\p2=(oaConnect),\p3=(\p1-|\p2)in%
        node[output,anchor=south east,xshift=-0.3em,yshift=0ex]at(\p3){%
            $O_a{=}{%
            \left\{%
            \renewcommand{\arraystretch}{1.0}%
            \begin{array}{lll}%
            Ag_a^1 \\ Ag_a^2 \\ Ag_a^3%
            \end{array}%
            \right\}%
            }$%
        };%
%
    \path[arrow,draw]($(p_a.south east) !.5! (p_a.east)$)--++%
        (0.5*\nodedistance,0)|-%
        (p_d.west)%
            node[input]{$I_d$};%
    \path[arrow,draw](p_a.east)%
        --(p_c.west)%
            node[input]{$I_c$};%
%
    \path[arrow,draw](p_b.east)%
            node[output]{$O_b$}%
        --++(0.5*\nodedistance,0)|-%
        ($(p_e.north west) !.33! (p_e.south west)$)%
            node[input]{$I_e$};%
    \path[arrow,draw](p_c.east)%
            node[output]{$O_c$}%
        --++(0.5*\nodedistance,0)|-%
        ($(p_e.north west) !.66! (p_e.south west)$);%
    \path[arrow,draw](p_d.east)%
            node[output]{$O_d$}%
        --(p_f.west)%
            node[input]{$I_f$};%
%
    \path[arrow,draw](p_e.east)%
            node[output]{$O_e$}%
        --++(0.5*\nodedistance,0)|-%
        ($(p_g.north west) !.33! (p_g.south west)$)%
            node[input,anchor=south west,xshift=-1.3em,yshift=1.75ex]{$I_g{=}O_e \cup O_f$};%
    \path[arrow,draw](p_f.east)%
            node[output]{$O_f$}%
        --++(0.5*\nodedistance,0)|-%
        ($(p_g.north west) !.66! (p_g.south west)$);%
%
%
%
%
%
%
% 	\draw(ctrlconnectl)--node[pos=0.4,align=left]%
% 		{OVSDB\\ Management}%
% 		(ctrlconnectl|-server.north);%
% 	\draw(ctrlconnectr)--node[pos=0.5,anchor=south,sloped]%
% 		{OpenFlow}%
% 		(switch.north);%
% 
% 
%
\end{pgfonlayer}%
%
	% Background
	\begin{pgfonlayer}{background}%
% 	%Ermittle Top Koordinate (Node mit oberster Kante)
% 	%und left Koordinate (Node mit linkster Kante)
% 		\path let \p1 = (server.north),%
% 			\p2 = (server.west)%
% 			in node (topleftnot)[shape=coordinate,inner sep=0pt] at (\x2,\y1) {};%
% 	%Ermittle Bottom Koordinate (Node mit unterster Kante)
% 	%und right Koordinate (Node mit rechtester Kante)
% 		\path let \p3 = (forwpath.south),%
% 			\p4 = (forwpath.east)%
% 			in node (bottomrightnot)[shape=coordinate,inner sep=0pt] at (\x4,\y3) {};%
% %
% 		\node(topleft)[shape=coordinate,inner sep=0pt]
% 			at($(topleftnot)+(-0.6,0.6)$){};
% 		\node(bottomright)[shape=coordinate,inner sep=0pt]
% 			at($(bottomrightnot)+(0.6,-0.6)$){};
% 		\node(bottomleft)[shape=coordinate,inner sep=0pt]at(topleft|-bottomright){};%
% 		\node(topright)[shape=coordinate,inner sep=0pt]at(topleft-|bottomright){};%
% %
% 	   % \path[draw=black,fill=gray]%
% 	   % 	(topleft)%
% 	   % 		rectangle%
% 	   % 	(bottomright);%
	\end{pgfonlayer}%
%
%	
%
%
%
\normalfont
%
\end{tikzpicture}%
%
%
\DenKrTikzStandalonePost%